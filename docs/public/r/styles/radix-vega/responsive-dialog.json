{
  "name": "responsive-dialog",
  "dependencies": [
    "vaul"
  ],
  "registryDependencies": [
    "dialog",
    "drawer",
    "@diceui/use-as-ref",
    "@diceui/use-isomorphic-layout-effect",
    "@diceui/use-lazy-ref",
    "@diceui/use-mobile"
  ],
  "files": [
    {
      "path": "ui/responsive-dialog.tsx",
      "content": "\"use client\";\r\n\r\nimport * as React from \"react\";\r\n\r\nimport {\r\n  Dialog,\r\n  DialogClose,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogOverlay,\r\n  DialogPortal,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport {\r\n  Drawer,\r\n  DrawerClose,\r\n  DrawerContent,\r\n  DrawerDescription,\r\n  DrawerFooter,\r\n  DrawerHeader,\r\n  DrawerOverlay,\r\n  DrawerPortal,\r\n  DrawerTitle,\r\n  DrawerTrigger,\r\n} from \"@/components/ui/drawer\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { useAsRef } from \"@/registry/bases/radix/hooks/use-as-ref\";\r\nimport { useIsomorphicLayoutEffect } from \"@/registry/bases/radix/hooks/use-isomorphic-layout-effect\";\r\nimport { useLazyRef } from \"@/registry/bases/radix/hooks/use-lazy-ref\";\r\nimport { useIsMobile } from \"@/registry/bases/radix/hooks/use-mobile\";\r\n\r\nconst ROOT_NAME = \"ResponsiveDialog\";\r\n\r\ninterface StoreState {\r\n  open: boolean;\r\n  isMobile: boolean;\r\n}\r\n\r\ninterface Store {\r\n  subscribe: (callback: () => void) => () => void;\r\n  getState: () => StoreState;\r\n  setState: <K extends keyof StoreState>(key: K, value: StoreState[K]) => void;\r\n  notify: () => void;\r\n}\r\n\r\nconst StoreContext = React.createContext<Store | null>(null);\r\n\r\nfunction useStore<T>(\r\n  selector: (state: StoreState) => T,\r\n  ogStore?: Store | null,\r\n): T {\r\n  const contextStore = React.useContext(StoreContext);\r\n  const store = ogStore ?? contextStore;\r\n\r\n  if (!store) {\r\n    throw new Error(`\\`useStore\\` must be used within \\`${ROOT_NAME}\\``);\r\n  }\r\n\r\n  const getSnapshot = React.useCallback(\r\n    () => selector(store.getState()),\r\n    [store, selector],\r\n  );\r\n\r\n  return React.useSyncExternalStore(store.subscribe, getSnapshot, getSnapshot);\r\n}\r\n\r\ninterface ResponsiveDialogProps extends React.ComponentProps<typeof Dialog> {\r\n  breakpoint?: number;\r\n}\r\n\r\nfunction ResponsiveDialog({\r\n  breakpoint = 768,\r\n  open: openProp,\r\n  defaultOpen = false,\r\n  onOpenChange: onOpenChangeProp,\r\n  ...props\r\n}: ResponsiveDialogProps) {\r\n  const isMobile = useIsMobile(breakpoint);\r\n\r\n  const listenersRef = useLazyRef(() => new Set<() => void>());\r\n  const stateRef = useLazyRef<StoreState>(() => ({\r\n    open: openProp ?? defaultOpen,\r\n    isMobile,\r\n  }));\r\n\r\n  const onOpenChangeRef = useAsRef(onOpenChangeProp);\r\n\r\n  const store = React.useMemo<Store>(() => {\r\n    return {\r\n      subscribe: (cb) => {\r\n        listenersRef.current.add(cb);\r\n        return () => listenersRef.current.delete(cb);\r\n      },\r\n      getState: () => stateRef.current,\r\n      setState: (key, value) => {\r\n        if (Object.is(stateRef.current[key], value)) return;\r\n\r\n        if (key === \"open\" && typeof value === \"boolean\") {\r\n          stateRef.current.open = value;\r\n          onOpenChangeRef.current?.(value);\r\n        } else {\r\n          stateRef.current[key] = value;\r\n        }\r\n\r\n        store.notify();\r\n      },\r\n      notify: () => {\r\n        for (const cb of listenersRef.current) {\r\n          cb();\r\n        }\r\n      },\r\n    };\r\n  }, [listenersRef, stateRef, onOpenChangeRef]);\r\n\r\n  const open = useStore((state) => state.open, store);\r\n\r\n  useIsomorphicLayoutEffect(() => {\r\n    if (openProp !== undefined) {\r\n      store.setState(\"open\", openProp);\r\n    }\r\n  }, [openProp]);\r\n\r\n  useIsomorphicLayoutEffect(() => {\r\n    store.setState(\"isMobile\", isMobile);\r\n  }, [isMobile]);\r\n\r\n  const onOpenChange = React.useCallback(\r\n    (value: boolean) => {\r\n      store.setState(\"open\", value);\r\n    },\r\n    [store],\r\n  );\r\n\r\n  if (isMobile) {\r\n    return (\r\n      <StoreContext.Provider value={store}>\r\n        <Drawer open={open} onOpenChange={onOpenChange} {...props} />\r\n      </StoreContext.Provider>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <StoreContext.Provider value={store}>\r\n      <Dialog open={open} onOpenChange={onOpenChange} {...props} />\r\n    </StoreContext.Provider>\r\n  );\r\n}\r\n\r\nfunction ResponsiveDialogTrigger({\r\n  ...props\r\n}: React.ComponentProps<typeof DialogTrigger>) {\r\n  const isMobile = useStore((state) => state.isMobile);\r\n\r\n  if (isMobile) {\r\n    return <DrawerTrigger data-variant=\"drawer\" {...props} />;\r\n  }\r\n\r\n  return <DialogTrigger data-variant=\"dialog\" {...props} />;\r\n}\r\n\r\nfunction ResponsiveDialogClose({\r\n  ...props\r\n}: React.ComponentProps<typeof DialogClose>) {\r\n  const isMobile = useStore((state) => state.isMobile);\r\n\r\n  if (isMobile) {\r\n    return <DrawerClose data-variant=\"drawer\" {...props} />;\r\n  }\r\n\r\n  return <DialogClose data-variant=\"dialog\" {...props} />;\r\n}\r\n\r\nfunction ResponsiveDialogPortal({\r\n  ...props\r\n}: React.ComponentProps<typeof DialogPortal>) {\r\n  const isMobile = useStore((state) => state.isMobile);\r\n\r\n  if (isMobile) {\r\n    return <DrawerPortal data-variant=\"drawer\" {...props} />;\r\n  }\r\n\r\n  return <DialogPortal data-variant=\"dialog\" {...props} />;\r\n}\r\n\r\nfunction ResponsiveDialogOverlay({\r\n  ...props\r\n}: React.ComponentProps<typeof DialogOverlay>) {\r\n  const isMobile = useStore((state) => state.isMobile);\r\n\r\n  if (isMobile) {\r\n    return <DrawerOverlay data-variant=\"drawer\" {...props} />;\r\n  }\r\n\r\n  return <DialogOverlay data-variant=\"dialog\" {...props} />;\r\n}\r\n\r\nfunction ResponsiveDialogContent({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof DialogContent>) {\r\n  const isMobile = useStore((state) => state.isMobile);\r\n\r\n  if (isMobile) {\r\n    return (\r\n      <DrawerContent\r\n        data-variant=\"drawer\"\r\n        className={cn(\"px-4 pb-4\", className)}\r\n        {...props}\r\n      />\r\n    );\r\n  }\r\n\r\n  return (\r\n    <DialogContent data-variant=\"dialog\" className={className} {...props} />\r\n  );\r\n}\r\n\r\nfunction ResponsiveDialogHeader({\r\n  ...props\r\n}: React.ComponentProps<typeof DialogHeader>) {\r\n  const isMobile = useStore((state) => state.isMobile);\r\n\r\n  if (isMobile) {\r\n    return <DrawerHeader data-variant=\"drawer\" {...props} />;\r\n  }\r\n\r\n  return <DialogHeader data-variant=\"dialog\" {...props} />;\r\n}\r\n\r\nfunction ResponsiveDialogFooter({\r\n  ...props\r\n}: React.ComponentProps<typeof DialogFooter>) {\r\n  const isMobile = useStore((state) => state.isMobile);\r\n\r\n  if (isMobile) {\r\n    return <DrawerFooter data-variant=\"drawer\" {...props} />;\r\n  }\r\n\r\n  return <DialogFooter data-variant=\"dialog\" {...props} />;\r\n}\r\n\r\nfunction ResponsiveDialogTitle({\r\n  ...props\r\n}: React.ComponentProps<typeof DialogTitle>) {\r\n  const isMobile = useStore((state) => state.isMobile);\r\n\r\n  if (isMobile) {\r\n    return <DrawerTitle data-variant=\"drawer\" {...props} />;\r\n  }\r\n\r\n  return <DialogTitle data-variant=\"dialog\" {...props} />;\r\n}\r\n\r\nfunction ResponsiveDialogDescription({\r\n  ...props\r\n}: React.ComponentProps<typeof DialogDescription>) {\r\n  const isMobile = useStore((state) => state.isMobile);\r\n\r\n  if (isMobile) {\r\n    return <DrawerDescription data-variant=\"drawer\" {...props} />;\r\n  }\r\n\r\n  return <DialogDescription data-variant=\"dialog\" {...props} />;\r\n}\r\n\r\nexport {\r\n  ResponsiveDialog,\r\n  ResponsiveDialogClose,\r\n  ResponsiveDialogContent,\r\n  ResponsiveDialogDescription,\r\n  ResponsiveDialogFooter,\r\n  ResponsiveDialogHeader,\r\n  ResponsiveDialogOverlay,\r\n  ResponsiveDialogPortal,\r\n  ResponsiveDialogTitle,\r\n  ResponsiveDialogTrigger,\r\n};\r\n",
      "type": "registry:ui",
      "target": ""
    }
  ],
  "type": "registry:ui"
}