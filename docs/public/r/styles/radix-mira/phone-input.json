{
  "name": "phone-input",
  "dependencies": [
    "radix-ui"
  ],
  "registryDependencies": [
    "command",
    "input",
    "popover",
    "@diceui/use-as-ref",
    "@diceui/use-isomorphic-layout-effect",
    "@diceui/use-lazy-ref"
  ],
  "files": [
    {
      "path": "ui/phone-input.tsx",
      "content": "\"use client\";\r\n\r\nimport { Check, ChevronDown } from \"lucide-react\";\r\nimport { Slot as SlotPrimitive } from \"radix-ui\";\r\nimport * as React from \"react\";\r\nimport {\r\n  Command,\r\n  CommandEmpty,\r\n  CommandGroup,\r\n  CommandInput,\r\n  CommandItem,\r\n  CommandList,\r\n} from \"@/components/ui/command\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport { useComposedRefs } from \"@/lib/compose-refs\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { VisuallyHiddenInput } from \"@/registry/bases/radix/components/visually-hidden-input\";\r\nimport { useAsRef } from \"@/registry/bases/radix/hooks/use-as-ref\";\r\nimport { useIsomorphicLayoutEffect } from \"@/registry/bases/radix/hooks/use-isomorphic-layout-effect\";\r\nimport { useLazyRef } from \"@/registry/bases/radix/hooks/use-lazy-ref\";\r\n\r\nconst ROOT_NAME = \"PhoneInput\";\r\nconst COUNTRY_SELECT_NAME = \"PhoneInputCountrySelect\";\r\nconst FIELD_NAME = \"PhoneInputField\";\r\n\r\n/**\r\n * @see https://github.com/mukeshsoni/country-telephone-data/blob/master/country_telephone_data.js\r\n * @format [iso2, dialCode]\r\n */\r\nconst COUNTRY_DATA: [string, string][] = [\r\n  [\"af\", \"93\"],\r\n  [\"ax\", \"358\"],\r\n  [\"al\", \"355\"],\r\n  [\"dz\", \"213\"],\r\n  [\"as\", \"1684\"],\r\n  [\"ad\", \"376\"],\r\n  [\"ao\", \"244\"],\r\n  [\"ai\", \"1264\"],\r\n  [\"ag\", \"1268\"],\r\n  [\"ar\", \"54\"],\r\n  [\"am\", \"374\"],\r\n  [\"aw\", \"297\"],\r\n  [\"au\", \"61\"],\r\n  [\"at\", \"43\"],\r\n  [\"az\", \"994\"],\r\n  [\"bs\", \"1242\"],\r\n  [\"bh\", \"973\"],\r\n  [\"bd\", \"880\"],\r\n  [\"bb\", \"1246\"],\r\n  [\"by\", \"375\"],\r\n  [\"be\", \"32\"],\r\n  [\"bz\", \"501\"],\r\n  [\"bj\", \"229\"],\r\n  [\"bm\", \"1441\"],\r\n  [\"bt\", \"975\"],\r\n  [\"bo\", \"591\"],\r\n  [\"ba\", \"387\"],\r\n  [\"bw\", \"267\"],\r\n  [\"br\", \"55\"],\r\n  [\"io\", \"246\"],\r\n  [\"vg\", \"1284\"],\r\n  [\"bn\", \"673\"],\r\n  [\"bg\", \"359\"],\r\n  [\"bf\", \"226\"],\r\n  [\"bi\", \"257\"],\r\n  [\"kh\", \"855\"],\r\n  [\"cm\", \"237\"],\r\n  [\"ca\", \"1\"],\r\n  [\"cv\", \"238\"],\r\n  [\"bq\", \"599\"],\r\n  [\"ky\", \"1345\"],\r\n  [\"cf\", \"236\"],\r\n  [\"td\", \"235\"],\r\n  [\"cl\", \"56\"],\r\n  [\"cn\", \"86\"],\r\n  [\"co\", \"57\"],\r\n  [\"km\", \"269\"],\r\n  [\"cd\", \"243\"],\r\n  [\"cg\", \"242\"],\r\n  [\"ck\", \"682\"],\r\n  [\"cr\", \"506\"],\r\n  [\"ci\", \"225\"],\r\n  [\"hr\", \"385\"],\r\n  [\"cu\", \"53\"],\r\n  [\"cw\", \"599\"],\r\n  [\"cy\", \"357\"],\r\n  [\"cz\", \"420\"],\r\n  [\"dk\", \"45\"],\r\n  [\"dj\", \"253\"],\r\n  [\"dm\", \"1767\"],\r\n  [\"do\", \"1\"],\r\n  [\"ec\", \"593\"],\r\n  [\"eg\", \"20\"],\r\n  [\"sv\", \"503\"],\r\n  [\"gq\", \"240\"],\r\n  [\"er\", \"291\"],\r\n  [\"ee\", \"372\"],\r\n  [\"et\", \"251\"],\r\n  [\"fk\", \"500\"],\r\n  [\"fo\", \"298\"],\r\n  [\"fj\", \"679\"],\r\n  [\"fi\", \"358\"],\r\n  [\"fr\", \"33\"],\r\n  [\"gf\", \"594\"],\r\n  [\"pf\", \"689\"],\r\n  [\"ga\", \"241\"],\r\n  [\"gm\", \"220\"],\r\n  [\"ge\", \"995\"],\r\n  [\"de\", \"49\"],\r\n  [\"gh\", \"233\"],\r\n  [\"gi\", \"350\"],\r\n  [\"gr\", \"30\"],\r\n  [\"gl\", \"299\"],\r\n  [\"gd\", \"1473\"],\r\n  [\"gp\", \"590\"],\r\n  [\"gu\", \"1671\"],\r\n  [\"gt\", \"502\"],\r\n  [\"gg\", \"44\"],\r\n  [\"gn\", \"224\"],\r\n  [\"gw\", \"245\"],\r\n  [\"gy\", \"592\"],\r\n  [\"ht\", \"509\"],\r\n  [\"hn\", \"504\"],\r\n  [\"hk\", \"852\"],\r\n  [\"hu\", \"36\"],\r\n  [\"is\", \"354\"],\r\n  [\"in\", \"91\"],\r\n  [\"id\", \"62\"],\r\n  [\"ir\", \"98\"],\r\n  [\"iq\", \"964\"],\r\n  [\"ie\", \"353\"],\r\n  [\"im\", \"44\"],\r\n  [\"il\", \"972\"],\r\n  [\"it\", \"39\"],\r\n  [\"jm\", \"1876\"],\r\n  [\"jp\", \"81\"],\r\n  [\"je\", \"44\"],\r\n  [\"jo\", \"962\"],\r\n  [\"kz\", \"7\"],\r\n  [\"ke\", \"254\"],\r\n  [\"ki\", \"686\"],\r\n  [\"xk\", \"383\"],\r\n  [\"kw\", \"965\"],\r\n  [\"kg\", \"996\"],\r\n  [\"la\", \"856\"],\r\n  [\"lv\", \"371\"],\r\n  [\"lb\", \"961\"],\r\n  [\"ls\", \"266\"],\r\n  [\"lr\", \"231\"],\r\n  [\"ly\", \"218\"],\r\n  [\"li\", \"423\"],\r\n  [\"lt\", \"370\"],\r\n  [\"lu\", \"352\"],\r\n  [\"mo\", \"853\"],\r\n  [\"mk\", \"389\"],\r\n  [\"mg\", \"261\"],\r\n  [\"mw\", \"265\"],\r\n  [\"my\", \"60\"],\r\n  [\"mv\", \"960\"],\r\n  [\"ml\", \"223\"],\r\n  [\"mt\", \"356\"],\r\n  [\"mh\", \"692\"],\r\n  [\"mq\", \"596\"],\r\n  [\"mr\", \"222\"],\r\n  [\"mu\", \"230\"],\r\n  [\"mx\", \"52\"],\r\n  [\"fm\", \"691\"],\r\n  [\"md\", \"373\"],\r\n  [\"mc\", \"377\"],\r\n  [\"mn\", \"976\"],\r\n  [\"me\", \"382\"],\r\n  [\"ms\", \"1664\"],\r\n  [\"ma\", \"212\"],\r\n  [\"mz\", \"258\"],\r\n  [\"mm\", \"95\"],\r\n  [\"na\", \"264\"],\r\n  [\"nr\", \"674\"],\r\n  [\"np\", \"977\"],\r\n  [\"nl\", \"31\"],\r\n  [\"nc\", \"687\"],\r\n  [\"nz\", \"64\"],\r\n  [\"ni\", \"505\"],\r\n  [\"ne\", \"227\"],\r\n  [\"ng\", \"234\"],\r\n  [\"nu\", \"683\"],\r\n  [\"nf\", \"672\"],\r\n  [\"kp\", \"850\"],\r\n  [\"mp\", \"1670\"],\r\n  [\"no\", \"47\"],\r\n  [\"om\", \"968\"],\r\n  [\"pk\", \"92\"],\r\n  [\"pw\", \"680\"],\r\n  [\"ps\", \"970\"],\r\n  [\"pa\", \"507\"],\r\n  [\"pg\", \"675\"],\r\n  [\"py\", \"595\"],\r\n  [\"pe\", \"51\"],\r\n  [\"ph\", \"63\"],\r\n  [\"pl\", \"48\"],\r\n  [\"pt\", \"351\"],\r\n  [\"pr\", \"1\"],\r\n  [\"qa\", \"974\"],\r\n  [\"re\", \"262\"],\r\n  [\"ro\", \"40\"],\r\n  [\"ru\", \"7\"],\r\n  [\"rw\", \"250\"],\r\n  [\"bl\", \"590\"],\r\n  [\"sh\", \"290\"],\r\n  [\"kn\", \"1869\"],\r\n  [\"lc\", \"1758\"],\r\n  [\"mf\", \"590\"],\r\n  [\"pm\", \"508\"],\r\n  [\"vc\", \"1784\"],\r\n  [\"ws\", \"685\"],\r\n  [\"sm\", \"378\"],\r\n  [\"st\", \"239\"],\r\n  [\"sa\", \"966\"],\r\n  [\"sn\", \"221\"],\r\n  [\"rs\", \"381\"],\r\n  [\"sc\", \"248\"],\r\n  [\"sl\", \"232\"],\r\n  [\"sg\", \"65\"],\r\n  [\"sx\", \"1721\"],\r\n  [\"sk\", \"421\"],\r\n  [\"si\", \"386\"],\r\n  [\"sb\", \"677\"],\r\n  [\"so\", \"252\"],\r\n  [\"za\", \"27\"],\r\n  [\"kr\", \"82\"],\r\n  [\"ss\", \"211\"],\r\n  [\"es\", \"34\"],\r\n  [\"lk\", \"94\"],\r\n  [\"sd\", \"249\"],\r\n  [\"sr\", \"597\"],\r\n  [\"sz\", \"268\"],\r\n  [\"se\", \"46\"],\r\n  [\"ch\", \"41\"],\r\n  [\"sy\", \"963\"],\r\n  [\"tw\", \"886\"],\r\n  [\"tj\", \"992\"],\r\n  [\"tz\", \"255\"],\r\n  [\"th\", \"66\"],\r\n  [\"tl\", \"670\"],\r\n  [\"tg\", \"228\"],\r\n  [\"tk\", \"690\"],\r\n  [\"to\", \"676\"],\r\n  [\"tt\", \"1868\"],\r\n  [\"tn\", \"216\"],\r\n  [\"tr\", \"90\"],\r\n  [\"tm\", \"993\"],\r\n  [\"tc\", \"1649\"],\r\n  [\"tv\", \"688\"],\r\n  [\"vi\", \"1340\"],\r\n  [\"ug\", \"256\"],\r\n  [\"ua\", \"380\"],\r\n  [\"ae\", \"971\"],\r\n  [\"gb\", \"44\"],\r\n  [\"us\", \"1\"],\r\n  [\"uy\", \"598\"],\r\n  [\"uz\", \"998\"],\r\n  [\"vu\", \"678\"],\r\n  [\"va\", \"39\"],\r\n  [\"ve\", \"58\"],\r\n  [\"vn\", \"84\"],\r\n  [\"wf\", \"681\"],\r\n  [\"eh\", \"212\"],\r\n  [\"ye\", \"967\"],\r\n  [\"zm\", \"260\"],\r\n  [\"zw\", \"263\"],\r\n];\r\n\r\ninterface Country {\r\n  code: string;\r\n  name: string;\r\n  dialCode: string;\r\n  flag?: string;\r\n}\r\n\r\nfunction getCountryName(countryCode: string, locale = \"en\"): string {\r\n  try {\r\n    const regionNames = new Intl.DisplayNames([locale], { type: \"region\" });\r\n    return regionNames.of(countryCode) ?? countryCode;\r\n  } catch {\r\n    return countryCode;\r\n  }\r\n}\r\n\r\nfunction getFlagEmoji(countryCode: string): string {\r\n  const codePoints = countryCode\r\n    .toUpperCase()\r\n    .split(\"\")\r\n    .map((char) => 127397 + char.charCodeAt(0));\r\n  return String.fromCodePoint(...codePoints);\r\n}\r\n\r\nfunction getCountries(): Country[] {\r\n  return COUNTRY_DATA.map(([iso2, dialCode]): Country => {\r\n    const code = iso2.toUpperCase();\r\n    return {\r\n      code,\r\n      name: getCountryName(code),\r\n      dialCode: `+${dialCode}`,\r\n      flag: getFlagEmoji(code),\r\n    };\r\n  }).sort((a, b) => a.name.localeCompare(b.name));\r\n}\r\n\r\nfunction detectCountryFromNumber(\r\n  value: string,\r\n  countries: Country[],\r\n): Country | undefined {\r\n  if (!value || !value.startsWith(\"+\")) return undefined;\r\n\r\n  const digits = value.slice(1).replace(/\\D/g, \"\");\r\n  if (!digits) return undefined;\r\n\r\n  const sorted = [...countries].sort(\r\n    (a, b) => b.dialCode.length - a.dialCode.length,\r\n  );\r\n\r\n  const matches: Country[] = [];\r\n  for (const country of sorted) {\r\n    const dialCode = country.dialCode.slice(1);\r\n    if (digits.startsWith(dialCode)) {\r\n      matches.push(country);\r\n    }\r\n  }\r\n\r\n  if (matches.length === 0) return undefined;\r\n\r\n  if (matches.length > 1 && matches[0]?.dialCode === \"+1\") {\r\n    const usCountry = matches.find((c) => c.code === \"US\");\r\n    if (usCountry) return usCountry;\r\n  }\r\n\r\n  return matches[0];\r\n}\r\n\r\nfunction formatPhoneNumber(value: string, countries: Country[]): string {\r\n  if (!value) return \"\";\r\n\r\n  const normalized = value.startsWith(\"+\") ? value : `+${value}`;\r\n\r\n  const digits = normalized.slice(1).replace(/\\D/g, \"\");\r\n  if (!digits) return \"+\";\r\n\r\n  const detected = detectCountryFromNumber(`+${digits}`, countries);\r\n  const dialCodeLength = detected\r\n    ? detected.dialCode.slice(1).length\r\n    : Math.min(digits.length, 3);\r\n\r\n  const countryCode = digits.slice(0, dialCodeLength);\r\n  const rest = digits.slice(dialCodeLength);\r\n\r\n  let formatted = `+${countryCode}`;\r\n\r\n  if (rest) {\r\n    formatted += \" \";\r\n    for (let i = 0; i < rest.length; i++) {\r\n      if (i > 0 && i % 3 === 0) {\r\n        formatted += \" \";\r\n      }\r\n      formatted += rest[i];\r\n    }\r\n  }\r\n\r\n  return formatted;\r\n}\r\n\r\ntype RootElement = React.ComponentRef<typeof PhoneInput>;\r\n\r\ninterface StoreState {\r\n  value: string;\r\n  country: string;\r\n  open: boolean;\r\n  startsWithPlus: boolean;\r\n}\r\n\r\ninterface Store {\r\n  subscribe: (callback: () => void) => () => void;\r\n  getState: () => StoreState;\r\n  setState: <K extends keyof StoreState>(key: K, value: StoreState[K]) => void;\r\n  notify: () => void;\r\n}\r\n\r\nconst StoreContext = React.createContext<Store | null>(null);\r\n\r\nfunction useStoreContext(consumerName: string) {\r\n  const context = React.useContext(StoreContext);\r\n  if (!context) {\r\n    throw new Error(`\\`${consumerName}\\` must be used within \\`${ROOT_NAME}\\``);\r\n  }\r\n  return context;\r\n}\r\n\r\nfunction useStore<T>(\r\n  selector: (state: StoreState) => T,\r\n  ogStore?: Store | null,\r\n): T {\r\n  const contextStore = React.useContext(StoreContext);\r\n\r\n  const store = ogStore ?? contextStore;\r\n\r\n  if (!store) {\r\n    throw new Error(`\\`useStore\\` must be used within \\`${ROOT_NAME}\\``);\r\n  }\r\n\r\n  const getSnapshot = React.useCallback(\r\n    () => selector(store.getState()),\r\n    [store, selector],\r\n  );\r\n\r\n  return React.useSyncExternalStore(store.subscribe, getSnapshot, getSnapshot);\r\n}\r\n\r\ninterface PhoneInputContextValue {\r\n  rootId: string;\r\n  countries: Country[];\r\n  placeholder: string;\r\n  disabled?: boolean;\r\n  readOnly?: boolean;\r\n  required?: boolean;\r\n  invalid?: boolean;\r\n  showFlag: boolean;\r\n  inputRef: React.RefObject<HTMLInputElement | null>;\r\n}\r\n\r\nconst PhoneInputContext = React.createContext<PhoneInputContextValue | null>(\r\n  null,\r\n);\r\n\r\nfunction usePhoneInputContext(consumerName: string) {\r\n  const context = React.useContext(PhoneInputContext);\r\n  if (!context) {\r\n    throw new Error(`\\`${consumerName}\\` must be used within \\`${ROOT_NAME}\\``);\r\n  }\r\n  return context;\r\n}\r\n\r\ninterface PhoneInputProps extends React.ComponentProps<\"div\"> {\r\n  defaultValue?: string;\r\n  value?: string;\r\n  onValueChange?: (value: string) => void;\r\n  defaultCountry?: string;\r\n  country?: string;\r\n  onCountryChange?: (country: string) => void;\r\n  countries?: Country[];\r\n  name?: string;\r\n  placeholder?: string;\r\n  asChild?: boolean;\r\n  disabled?: boolean;\r\n  readOnly?: boolean;\r\n  required?: boolean;\r\n  invalid?: boolean;\r\n  showFlag?: boolean;\r\n}\r\n\r\nfunction PhoneInput(props: PhoneInputProps) {\r\n  const {\r\n    value: valueProp,\r\n    defaultValue,\r\n    defaultCountry,\r\n    country: countryProp,\r\n    onValueChange,\r\n    onCountryChange,\r\n    countries = getCountries(),\r\n    name,\r\n    placeholder = \"Enter phone number\",\r\n    asChild,\r\n    disabled,\r\n    required,\r\n    readOnly,\r\n    invalid,\r\n    showFlag = true,\r\n    className,\r\n    id,\r\n    ref,\r\n    ...rootProps\r\n  } = props;\r\n\r\n  const instanceId = React.useId();\r\n  const rootId = id ?? instanceId;\r\n\r\n  const inputRef = React.useRef<HTMLInputElement>(null);\r\n\r\n  const [formTrigger, setFormTrigger] = React.useState<RootElement | null>(\r\n    null,\r\n  );\r\n  const composedRef = useComposedRefs(ref, (node) => setFormTrigger(node));\r\n  const isFormControl = formTrigger ? !!formTrigger.closest(\"form\") : true;\r\n\r\n  const listenersRef = useLazyRef(() => new Set<() => void>());\r\n  const stateRef = useLazyRef<StoreState>(() => {\r\n    const initialValue = valueProp ?? defaultValue ?? \"\";\r\n    const initialCountry = countryProp ?? defaultCountry ?? \"\";\r\n\r\n    return {\r\n      value: initialValue,\r\n      country: initialCountry,\r\n      open: false,\r\n      startsWithPlus: initialValue.startsWith(\"+\"),\r\n    };\r\n  });\r\n\r\n  const propsRef = useAsRef({\r\n    onValueChange,\r\n    onCountryChange,\r\n  });\r\n\r\n  const store = React.useMemo<Store>(() => {\r\n    return {\r\n      subscribe: (cb) => {\r\n        listenersRef.current.add(cb);\r\n        return () => listenersRef.current.delete(cb);\r\n      },\r\n      getState: () => stateRef.current,\r\n      setState: (key, value) => {\r\n        if (Object.is(stateRef.current[key], value)) return;\r\n\r\n        if (key === \"value\" && typeof value === \"string\") {\r\n          stateRef.current.value = value;\r\n          propsRef.current.onValueChange?.(value);\r\n        } else if (key === \"country\" && typeof value === \"string\") {\r\n          stateRef.current.country = value;\r\n          propsRef.current.onCountryChange?.(value);\r\n        } else {\r\n          stateRef.current[key] = value;\r\n        }\r\n\r\n        store.notify();\r\n      },\r\n      notify: () => {\r\n        for (const cb of listenersRef.current) {\r\n          cb();\r\n        }\r\n      },\r\n    };\r\n  }, [listenersRef, stateRef, propsRef]);\r\n\r\n  const value = useStore((state) => state.value, store);\r\n  const country = useStore((state) => state.country, store);\r\n\r\n  useIsomorphicLayoutEffect(() => {\r\n    if (valueProp !== undefined) {\r\n      store.setState(\"value\", valueProp);\r\n    }\r\n  }, [valueProp]);\r\n\r\n  useIsomorphicLayoutEffect(() => {\r\n    if (countryProp !== undefined) {\r\n      store.setState(\"country\", countryProp);\r\n    }\r\n  }, [countryProp]);\r\n\r\n  const startsWithPlus = useStore((state) => state.startsWithPlus, store);\r\n\r\n  React.useEffect(() => {\r\n    if (!value) return;\r\n\r\n    const digits = value.slice(1).replace(/\\D/g, \"\");\r\n    const shouldDetect = startsWithPlus || digits.length >= 10;\r\n\r\n    if (!shouldDetect) return;\r\n\r\n    const detected = detectCountryFromNumber(value, countries);\r\n    if (detected && detected.code !== country) {\r\n      store.setState(\"country\", detected.code);\r\n    }\r\n  }, [value, countries, country, store, startsWithPlus]);\r\n\r\n  const contextValue = React.useMemo<PhoneInputContextValue>(\r\n    () => ({\r\n      rootId,\r\n      countries,\r\n      placeholder,\r\n      disabled,\r\n      readOnly,\r\n      required,\r\n      invalid,\r\n      showFlag,\r\n      inputRef,\r\n    }),\r\n    [\r\n      rootId,\r\n      countries,\r\n      placeholder,\r\n      disabled,\r\n      required,\r\n      readOnly,\r\n      invalid,\r\n      showFlag,\r\n    ],\r\n  );\r\n\r\n  const RootPrimitive = asChild ? SlotPrimitive.Slot : \"div\";\r\n\r\n  return (\r\n    <StoreContext.Provider value={store}>\r\n      <PhoneInputContext.Provider value={contextValue}>\r\n        <RootPrimitive\r\n          role=\"group\"\r\n          data-slot=\"phone-input\"\r\n          data-disabled={disabled ? \"\" : undefined}\r\n          data-invalid={invalid ? \"\" : undefined}\r\n          data-readonly={readOnly ? \"\" : undefined}\r\n          id={rootId}\r\n          {...rootProps}\r\n          ref={composedRef}\r\n          className={cn(\r\n            \"relative flex h-10 w-full items-center rounded-md border border-input bg-background transition-colors has-[[data-slot=input-group-control]:focus-visible]:border-ring has-[[data-slot][aria-invalid=true]]:border-destructive has-[[data-slot=input-group-control]:focus-visible]:ring-[3px] has-[[data-slot=input-group-control]:focus-visible]:ring-ring/50 has-[[data-slot][aria-invalid=true]]:ring-[3px] has-[[data-slot][aria-invalid=true]]:ring-destructive/20 data-disabled:cursor-not-allowed data-disabled:opacity-50 dark:bg-input/30 dark:has-[[data-slot][aria-invalid=true]]:ring-destructive/40\",\r\n            className,\r\n          )}\r\n        />\r\n        {isFormControl && (\r\n          <VisuallyHiddenInput\r\n            type=\"hidden\"\r\n            control={formTrigger}\r\n            name={name}\r\n            value={value}\r\n            disabled={disabled}\r\n            readOnly={readOnly}\r\n            required={required}\r\n          />\r\n        )}\r\n      </PhoneInputContext.Provider>\r\n    </StoreContext.Provider>\r\n  );\r\n}\r\n\r\ninterface PhoneInputCountrySelectProps\r\n  extends React.ComponentProps<typeof Popover>,\r\n    Pick<\r\n      React.ComponentProps<typeof PopoverTrigger>,\r\n      \"disabled\" | \"className\"\r\n    > {}\r\n\r\nfunction PhoneInputCountrySelect(props: PhoneInputCountrySelectProps) {\r\n  const {\r\n    disabled: disabledProp,\r\n    className,\r\n    children,\r\n    onOpenChange: onOpenChangeProp,\r\n    ...popoverProps\r\n  } = props;\r\n\r\n  const { countries, inputRef, disabled, showFlag } =\r\n    usePhoneInputContext(COUNTRY_SELECT_NAME);\r\n  const store = useStoreContext(COUNTRY_SELECT_NAME);\r\n  const country = useStore((state) => state.country);\r\n  const open = useStore((state) => state.open);\r\n\r\n  const isDisabled = disabledProp || disabled;\r\n\r\n  const countryContext = countries.find((c) => c.code === country);\r\n\r\n  const onOpenChange = React.useCallback(\r\n    (open: boolean) => {\r\n      store.setState(\"open\", open);\r\n      onOpenChangeProp?.(open);\r\n    },\r\n    [store, onOpenChangeProp],\r\n  );\r\n\r\n  return (\r\n    <Popover open={open} onOpenChange={onOpenChange} {...popoverProps}>\r\n      <PopoverTrigger\r\n        data-slot=\"phone-input-country-select\"\r\n        disabled={isDisabled}\r\n        className={cn(\r\n          \"flex h-full shrink-0 items-center gap-2 rounded-l-md border-input border-r bg-transparent px-3 text-sm transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:z-10 focus-visible:border-ring focus-visible:outline-hidden focus-visible:ring-[3px] focus-visible:ring-ring/50 disabled:pointer-events-none disabled:opacity-50 aria-invalid:border-destructive aria-invalid:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40\",\r\n          className,\r\n        )}\r\n      >\r\n        {!countryContext ? (\r\n          <div className=\"h-4 w-6 rounded bg-muted/50\" />\r\n        ) : (\r\n          showFlag &&\r\n          countryContext.flag && (\r\n            <div className=\"w-6 text-lg leading-none\">\r\n              {countryContext.flag}\r\n            </div>\r\n          )\r\n        )}\r\n        <ChevronDown className=\"size-4 opacity-50\" />\r\n      </PopoverTrigger>\r\n      <PopoverContent className=\"w-[300px] p-0\" align=\"start\">\r\n        <Command>\r\n          <CommandInput placeholder=\"Search country...\" />\r\n          <CommandList>\r\n            <CommandEmpty>No country found.</CommandEmpty>\r\n            <CommandGroup>\r\n              {countries.map((c) => (\r\n                <CommandItem\r\n                  key={c.code}\r\n                  value={`${c.name} ${c.dialCode} ${c.code}`}\r\n                  onSelect={() => {\r\n                    store.setState(\"country\", c.code);\r\n                    store.setState(\"open\", false);\r\n                    requestAnimationFrame(() => {\r\n                      inputRef.current?.focus();\r\n                    });\r\n                  }}\r\n                >\r\n                  {showFlag && c.flag && (\r\n                    <span className=\"text-lg\">{c.flag}</span>\r\n                  )}\r\n                  <span className=\"flex-1\">{c.name}</span>\r\n                  <span className=\"text-muted-foreground\">{c.dialCode}</span>\r\n                  <Check\r\n                    className={cn(\r\n                      \"size-4\",\r\n                      country === c.code ? \"opacity-100\" : \"opacity-0\",\r\n                    )}\r\n                  />\r\n                </CommandItem>\r\n              ))}\r\n            </CommandGroup>\r\n          </CommandList>\r\n        </Command>\r\n      </PopoverContent>\r\n    </Popover>\r\n  );\r\n}\r\n\r\nfunction PhoneInputField(props: React.ComponentProps<\"input\">) {\r\n  const {\r\n    onChange: onChangeProp,\r\n    className,\r\n    disabled: disabledProp,\r\n    readOnly: readOnlyProp,\r\n    required: requiredProp,\r\n    ref,\r\n    ...inputProps\r\n  } = props;\r\n\r\n  const {\r\n    inputRef,\r\n    disabled,\r\n    invalid,\r\n    readOnly,\r\n    required,\r\n    placeholder,\r\n    countries,\r\n  } = usePhoneInputContext(FIELD_NAME);\r\n  const store = useStoreContext(FIELD_NAME);\r\n  const value = useStore((state) => state.value);\r\n\r\n  const composedRef = useComposedRefs(ref, inputRef);\r\n\r\n  const onChangeRef = useAsRef(onChangeProp);\r\n\r\n  const isDisabled = disabledProp || disabled;\r\n  const isReadOnly = readOnlyProp || readOnly;\r\n  const isRequired = requiredProp || required;\r\n\r\n  const onChange = React.useCallback(\r\n    (event: React.ChangeEvent<HTMLInputElement>) => {\r\n      if (isDisabled || isReadOnly) return;\r\n\r\n      onChangeRef.current?.(event);\r\n      if (event.defaultPrevented) return;\r\n\r\n      const inputValue = event.target.value;\r\n\r\n      const startsWithPlus = inputValue.startsWith(\"+\");\r\n      const digits = inputValue.replace(/\\D/g, \"\");\r\n      const newValue = digits ? `+${digits}` : startsWithPlus ? \"+\" : \"\";\r\n      store.setState(\"startsWithPlus\", startsWithPlus);\r\n      store.setState(\"value\", newValue);\r\n    },\r\n    [store, onChangeRef, isDisabled, isReadOnly],\r\n  );\r\n\r\n  const displayValue = React.useMemo(() => {\r\n    return formatPhoneNumber(value, countries);\r\n  }, [value, countries]);\r\n\r\n  return (\r\n    <Input\r\n      type=\"tel\"\r\n      inputMode=\"tel\"\r\n      aria-required={isRequired}\r\n      aria-invalid={invalid}\r\n      data-slot=\"phone-input-field\"\r\n      disabled={isDisabled}\r\n      readOnly={isReadOnly}\r\n      required={isRequired}\r\n      {...inputProps}\r\n      ref={composedRef}\r\n      className={cn(\r\n        \"h-full flex-1 rounded-r-md rounded-l-none border-0 bg-transparent shadow-none focus-visible:border-ring focus-visible:ring-[3px] focus-visible:ring-ring/50 disabled:bg-transparent aria-invalid:border-destructive aria-invalid:ring-[3px] aria-invalid:ring-destructive/20 dark:bg-transparent dark:aria-invalid:ring-destructive/40 dark:disabled:bg-transparent\",\r\n        className,\r\n      )}\r\n      placeholder={placeholder}\r\n      value={displayValue}\r\n      onChange={onChange}\r\n    />\r\n  );\r\n}\r\n\r\nexport {\r\n  PhoneInput,\r\n  PhoneInputCountrySelect,\r\n  PhoneInputField,\r\n  //\r\n  useStore as usePhoneInput,\r\n  //\r\n  type PhoneInputProps,\r\n};\r\n",
      "type": "registry:ui",
      "target": ""
    },
    {
      "path": "components/visually-hidden-input.tsx",
      "content": "\"use client\";\r\n\r\nimport * as React from \"react\";\r\n\r\ntype InputValue = string[] | string;\r\n\r\ninterface VisuallyHiddenInputProps<T = InputValue>\r\n  extends Omit<\r\n    React.InputHTMLAttributes<HTMLInputElement>,\r\n    \"value\" | \"checked\" | \"onReset\"\r\n  > {\r\n  value?: T;\r\n  checked?: boolean;\r\n  control: HTMLElement | null;\r\n  bubbles?: boolean;\r\n}\r\n\r\nfunction VisuallyHiddenInput<T = InputValue>(\r\n  props: VisuallyHiddenInputProps<T>,\r\n) {\r\n  const {\r\n    control,\r\n    value,\r\n    checked,\r\n    bubbles = true,\r\n    type = \"hidden\",\r\n    style,\r\n    ...inputProps\r\n  } = props;\r\n\r\n  const isCheckInput = React.useMemo(\r\n    () => type === \"checkbox\" || type === \"radio\" || type === \"switch\",\r\n    [type],\r\n  );\r\n  const inputRef = React.useRef<HTMLInputElement>(null);\r\n\r\n  const prevValueRef = React.useRef<{\r\n    value: T | boolean | undefined;\r\n    previous: T | boolean | undefined;\r\n  }>({\r\n    value: isCheckInput ? checked : value,\r\n    previous: isCheckInput ? checked : value,\r\n  });\r\n\r\n  const prevValue = React.useMemo(() => {\r\n    const currentValue = isCheckInput ? checked : value;\r\n    if (prevValueRef.current.value !== currentValue) {\r\n      prevValueRef.current.previous = prevValueRef.current.value;\r\n      prevValueRef.current.value = currentValue;\r\n    }\r\n    return prevValueRef.current.previous;\r\n  }, [isCheckInput, value, checked]);\r\n\r\n  const [controlSize, setControlSize] = React.useState<{\r\n    width?: number;\r\n    height?: number;\r\n  }>({});\r\n\r\n  React.useLayoutEffect(() => {\r\n    if (!control) {\r\n      setControlSize({});\r\n      return;\r\n    }\r\n\r\n    setControlSize({\r\n      width: control.offsetWidth,\r\n      height: control.offsetHeight,\r\n    });\r\n\r\n    if (typeof window === \"undefined\") return;\r\n\r\n    const resizeObserver = new ResizeObserver((entries) => {\r\n      if (!Array.isArray(entries) || !entries.length) return;\r\n\r\n      const entry = entries[0];\r\n      if (!entry) return;\r\n\r\n      let width: number;\r\n      let height: number;\r\n\r\n      if (\"borderBoxSize\" in entry) {\r\n        const borderSizeEntry = entry.borderBoxSize;\r\n        const borderSize = Array.isArray(borderSizeEntry)\r\n          ? borderSizeEntry[0]\r\n          : borderSizeEntry;\r\n        width = borderSize.inlineSize;\r\n        height = borderSize.blockSize;\r\n      } else {\r\n        width = control.offsetWidth;\r\n        height = control.offsetHeight;\r\n      }\r\n\r\n      setControlSize({ width, height });\r\n    });\r\n\r\n    resizeObserver.observe(control, { box: \"border-box\" });\r\n    return () => {\r\n      resizeObserver.disconnect();\r\n    };\r\n  }, [control]);\r\n\r\n  React.useEffect(() => {\r\n    const input = inputRef.current;\r\n    if (!input) return;\r\n\r\n    const inputProto = window.HTMLInputElement.prototype;\r\n    const propertyKey = isCheckInput ? \"checked\" : \"value\";\r\n    const eventType = isCheckInput ? \"click\" : \"input\";\r\n    const currentValue = isCheckInput ? checked : value;\r\n\r\n    const serializedCurrentValue = isCheckInput\r\n      ? checked\r\n      : typeof value === \"object\" && value !== null\r\n        ? JSON.stringify(value)\r\n        : value;\r\n\r\n    const descriptor = Object.getOwnPropertyDescriptor(inputProto, propertyKey);\r\n\r\n    const setter = descriptor?.set;\r\n\r\n    if (prevValue !== currentValue && setter) {\r\n      const event = new Event(eventType, { bubbles });\r\n      setter.call(input, serializedCurrentValue);\r\n      input.dispatchEvent(event);\r\n    }\r\n  }, [prevValue, value, checked, bubbles, isCheckInput]);\r\n\r\n  const composedStyle = React.useMemo<React.CSSProperties>(() => {\r\n    return {\r\n      ...style,\r\n      ...(controlSize.width !== undefined && controlSize.height !== undefined\r\n        ? controlSize\r\n        : {}),\r\n      border: 0,\r\n      clip: \"rect(0 0 0 0)\",\r\n      clipPath: \"inset(50%)\",\r\n      height: \"1px\",\r\n      margin: \"-1px\",\r\n      overflow: \"hidden\",\r\n      padding: 0,\r\n      position: \"absolute\",\r\n      whiteSpace: \"nowrap\",\r\n      width: \"1px\",\r\n    };\r\n  }, [style, controlSize]);\r\n\r\n  return (\r\n    <input\r\n      type={type}\r\n      {...inputProps}\r\n      ref={inputRef}\r\n      aria-hidden={isCheckInput}\r\n      tabIndex={-1}\r\n      defaultChecked={isCheckInput ? checked : undefined}\r\n      style={composedStyle}\r\n    />\r\n  );\r\n}\r\n\r\nexport { VisuallyHiddenInput };\r\n",
      "type": "registry:component",
      "target": ""
    },
    {
      "path": "lib/compose-refs.ts",
      "content": "import * as React from \"react\";\r\n\r\ntype PossibleRef<T> = React.Ref<T> | undefined;\r\n\r\n/**\r\n * Set a given ref to a given value\r\n * This utility takes care of different types of refs: callback refs and RefObject(s)\r\n */\r\nfunction setRef<T>(ref: PossibleRef<T>, value: T) {\r\n  if (typeof ref === \"function\") {\r\n    return ref(value);\r\n  }\r\n\r\n  if (ref !== null && ref !== undefined) {\r\n    ref.current = value;\r\n  }\r\n}\r\n\r\n/**\r\n * A utility to compose multiple refs together\r\n * Accepts callback refs and RefObject(s)\r\n */\r\nfunction composeRefs<T>(...refs: PossibleRef<T>[]): React.RefCallback<T> {\r\n  return (node) => {\r\n    let hasCleanup = false;\r\n    const cleanups = refs.map((ref) => {\r\n      const cleanup = setRef(ref, node);\r\n      if (!hasCleanup && typeof cleanup === \"function\") {\r\n        hasCleanup = true;\r\n      }\r\n      return cleanup;\r\n    });\r\n\r\n    // React <19 will log an error to the console if a callback ref returns a\r\n    // value. We don't use ref cleanups internally so this will only happen if a\r\n    // user's ref callback returns a value, which we only expect if they are\r\n    // using the cleanup functionality added in React 19.\r\n    if (hasCleanup) {\r\n      return () => {\r\n        for (let i = 0; i < cleanups.length; i++) {\r\n          const cleanup = cleanups[i];\r\n          if (typeof cleanup === \"function\") {\r\n            cleanup();\r\n          } else {\r\n            setRef(refs[i], null);\r\n          }\r\n        }\r\n      };\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * A custom hook that composes multiple refs\r\n * Accepts callback refs and RefObject(s)\r\n */\r\nfunction useComposedRefs<T>(...refs: PossibleRef<T>[]): React.RefCallback<T> {\r\n  // biome-ignore lint/correctness/useExhaustiveDependencies: we want to memoize by all values\r\n  return React.useCallback(composeRefs(...refs), refs);\r\n}\r\n\r\nexport { composeRefs, useComposedRefs };\r\n",
      "type": "registry:lib",
      "target": ""
    }
  ],
  "type": "registry:ui"
}