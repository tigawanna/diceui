{
  "name": "stack",
  "dependencies": [
    "radix-ui"
  ],
  "files": [
    {
      "path": "ui/stack.tsx",
      "content": "\"use client\";\r\n\r\nimport { cva } from \"class-variance-authority\";\r\nimport { Slot as SlotPrimitive } from \"radix-ui\";\r\nimport * as React from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface ItemDimension {\r\n  itemId: number;\r\n  size: number;\r\n}\r\n\r\ntype Side = \"top\" | \"bottom\";\r\n\r\nfunction getDataState(isExpanded: boolean) {\r\n  return isExpanded ? \"expanded\" : \"collapsed\";\r\n}\r\n\r\ninterface StackContextValue {\r\n  side: Side;\r\n  childrenCount: number;\r\n  itemCount: number;\r\n  expandedItemCount: number;\r\n  gap: number;\r\n  scale: number;\r\n  offset: number;\r\n  expandOnHover: boolean;\r\n  isExpanded: boolean;\r\n  isInteracting: boolean;\r\n  dimensions: ItemDimension[];\r\n  setDimensions: React.Dispatch<React.SetStateAction<ItemDimension[]>>;\r\n}\r\n\r\nconst StackContext = React.createContext<StackContextValue | null>(null);\r\n\r\nfunction useStackContext(consumerName: string) {\r\n  const context = React.useContext(StackContext);\r\n  if (!context) {\r\n    throw new Error(`\\`${consumerName}\\` must be used within \\`Stack\\``);\r\n  }\r\n  return context;\r\n}\r\n\r\ninterface StackProps extends React.ComponentProps<\"div\"> {\r\n  side?: Side;\r\n  itemCount?: number;\r\n  expandedItemCount?: number;\r\n  gap?: number;\r\n  scale?: number;\r\n  offset?: number;\r\n  expandOnHover?: boolean;\r\n  asChild?: boolean;\r\n}\r\n\r\nfunction Stack(props: StackProps) {\r\n  const {\r\n    side = \"bottom\",\r\n    itemCount = 3,\r\n    expandedItemCount,\r\n    gap = 8,\r\n    scale = 0.05,\r\n    offset = 10,\r\n    className,\r\n    children,\r\n    style,\r\n    onMouseEnter: onMouseEnterProp,\r\n    onMouseLeave: onMouseLeaveProp,\r\n    onMouseMove: onMouseMoveProp,\r\n    onPointerDown: onPointerDownProp,\r\n    onPointerUp: onPointerUpProp,\r\n    expandOnHover = false,\r\n    asChild,\r\n    ...rootProps\r\n  } = props;\r\n\r\n  const [isExpanded, setIsExpanded] = React.useState(false);\r\n  const [isInteracting, setIsInteracting] = React.useState(false);\r\n  const [dimensions, setDimensions] = React.useState<ItemDimension[]>([]);\r\n\r\n  const childrenArray = React.Children.toArray(children).filter(\r\n    React.isValidElement,\r\n  );\r\n  const childrenCount = childrenArray.length;\r\n\r\n  const effectiveExpandedItemCount = expandedItemCount ?? childrenCount;\r\n\r\n  const onMouseEnter = React.useCallback(\r\n    (event: React.MouseEvent<HTMLDivElement>) => {\r\n      onMouseEnterProp?.(event);\r\n      if (event.defaultPrevented) return;\r\n\r\n      if (expandOnHover) {\r\n        setIsExpanded(true);\r\n      }\r\n    },\r\n    [expandOnHover, onMouseEnterProp],\r\n  );\r\n\r\n  const onMouseMove = React.useCallback(\r\n    (event: React.MouseEvent<HTMLDivElement>) => {\r\n      onMouseMoveProp?.(event);\r\n      if (event.defaultPrevented) return;\r\n\r\n      if (expandOnHover) {\r\n        setIsExpanded(true);\r\n      }\r\n    },\r\n    [expandOnHover, onMouseMoveProp],\r\n  );\r\n\r\n  const onMouseLeave = React.useCallback(\r\n    (event: React.MouseEvent<HTMLDivElement>) => {\r\n      onMouseLeaveProp?.(event);\r\n      if (event.defaultPrevented) return;\r\n\r\n      if (expandOnHover && !isInteracting) {\r\n        setIsExpanded(false);\r\n      }\r\n    },\r\n    [expandOnHover, isInteracting, onMouseLeaveProp],\r\n  );\r\n\r\n  const onPointerDown = React.useCallback(\r\n    (event: React.PointerEvent<HTMLDivElement>) => {\r\n      onPointerDownProp?.(event);\r\n      if (event.defaultPrevented) return;\r\n\r\n      setIsInteracting(true);\r\n    },\r\n    [onPointerDownProp],\r\n  );\r\n\r\n  const onPointerUp = React.useCallback(\r\n    (event: React.PointerEvent<HTMLDivElement>) => {\r\n      onPointerUpProp?.(event);\r\n      if (event.defaultPrevented) return;\r\n\r\n      setIsInteracting(false);\r\n    },\r\n    [onPointerUpProp],\r\n  );\r\n\r\n  const contextValue = React.useMemo<StackContextValue>(\r\n    () => ({\r\n      side,\r\n      childrenCount,\r\n      itemCount,\r\n      expandedItemCount: effectiveExpandedItemCount,\r\n      gap,\r\n      scale,\r\n      offset,\r\n      expandOnHover,\r\n      isExpanded,\r\n      isInteracting,\r\n      dimensions,\r\n      setDimensions,\r\n    }),\r\n    [\r\n      side,\r\n      childrenCount,\r\n      itemCount,\r\n      effectiveExpandedItemCount,\r\n      gap,\r\n      scale,\r\n      offset,\r\n      expandOnHover,\r\n      isExpanded,\r\n      isInteracting,\r\n      dimensions,\r\n    ],\r\n  );\r\n\r\n  const RootPrimitive = asChild ? SlotPrimitive.Slot : \"div\";\r\n\r\n  return (\r\n    <StackContext.Provider value={contextValue}>\r\n      <RootPrimitive\r\n        data-slot=\"stack\"\r\n        data-state={getDataState(isExpanded)}\r\n        onMouseEnter={onMouseEnter}\r\n        onMouseMove={onMouseMove}\r\n        onMouseLeave={onMouseLeave}\r\n        onPointerDown={onPointerDown}\r\n        onPointerUp={onPointerUp}\r\n        {...rootProps}\r\n        className={cn(\"relative w-full\", className)}\r\n        style={\r\n          {\r\n            \"--gap\": `${gap}px`,\r\n            \"--offset\": `${offset}px`,\r\n            \"--scale\": scale,\r\n            ...style,\r\n          } as React.CSSProperties\r\n        }\r\n      >\r\n        {childrenArray.map((child, index) => (\r\n          <StackItemWrapper key={index} index={index}>\r\n            {child}\r\n          </StackItemWrapper>\r\n        ))}\r\n      </RootPrimitive>\r\n    </StackContext.Provider>\r\n  );\r\n}\r\n\r\nconst stackItemWrapperVariants = cva(\r\n  \"absolute w-full transition-all duration-300 ease-out\",\r\n  {\r\n    variants: {\r\n      side: {\r\n        top: [\r\n          \"top-0 left-0 origin-top\",\r\n          \"translate-y-[calc(var(--translate)*-1)] scale-[var(--item-scale)]\",\r\n          \"after:absolute after:top-full after:left-0 after:w-full after:content-['']\",\r\n        ],\r\n        bottom: [\r\n          \"bottom-0 left-0 origin-bottom\",\r\n          \"translate-y-[var(--translate)] scale-[var(--item-scale)]\",\r\n          \"after:absolute after:bottom-full after:left-0 after:w-full after:content-['']\",\r\n        ],\r\n      },\r\n      isExpanded: {\r\n        true: \"after:h-[calc(var(--gap)+1px)]\",\r\n        false: \"\",\r\n      },\r\n      isVisible: {\r\n        true: \"\",\r\n        false: \"pointer-events-none\",\r\n      },\r\n    },\r\n  },\r\n);\r\n\r\ntype StackItemWrapperElement = React.ComponentRef<typeof StackItemWrapper>;\r\n\r\ninterface StackItemWrapperProps extends React.ComponentProps<\"div\"> {\r\n  index: number;\r\n}\r\n\r\nfunction StackItemWrapper(props: StackItemWrapperProps) {\r\n  const { children, className, index, style, ...itemProps } = props;\r\n\r\n  const {\r\n    side,\r\n    childrenCount,\r\n    itemCount,\r\n    expandedItemCount,\r\n    gap,\r\n    scale,\r\n    offset,\r\n    isExpanded,\r\n    dimensions,\r\n    setDimensions,\r\n  } = useStackContext(\"StackItemWrapper\");\r\n\r\n  const itemRef = React.useRef<StackItemWrapperElement>(null);\r\n\r\n  const isFront = index === 0;\r\n  const isVisible = isExpanded ? index < expandedItemCount : index < itemCount;\r\n\r\n  React.useEffect(() => {\r\n    const itemNode = itemRef.current;\r\n    if (itemNode) {\r\n      const rect = itemNode.getBoundingClientRect();\r\n      const measuredHeight = rect.height;\r\n      const currentScale = 1 - index * scale;\r\n      const naturalHeight = measuredHeight / currentScale;\r\n\r\n      setDimensions((d) => {\r\n        const existing = d.find((item) => item.itemId === index);\r\n        if (!existing) {\r\n          return [...d, { itemId: index, size: naturalHeight }];\r\n        }\r\n        return d;\r\n      });\r\n    }\r\n  }, [index, scale, setDimensions]);\r\n\r\n  const itemsSizeBefore = React.useMemo(() => {\r\n    return dimensions.reduce((prev, curr) => {\r\n      if (curr.itemId >= index) return prev;\r\n      return prev + curr.size;\r\n    }, 0);\r\n  }, [dimensions, index]);\r\n\r\n  const itemScale = isExpanded ? 1 : 1 - index * scale;\r\n  const translateValue = isExpanded\r\n    ? index * gap + itemsSizeBefore\r\n    : index * offset;\r\n  const zIndex = childrenCount - index;\r\n\r\n  const opacity = !isVisible ? 0 : isExpanded ? 1 : 1 - index * 0.15;\r\n\r\n  return (\r\n    <div\r\n      ref={itemRef}\r\n      data-slot=\"stack-item-wrapper\"\r\n      data-index={index}\r\n      data-front={isFront}\r\n      data-visible={isVisible}\r\n      data-expanded={isExpanded}\r\n      className={cn(\r\n        stackItemWrapperVariants({ side, isExpanded, isVisible, className }),\r\n      )}\r\n      style={\r\n        {\r\n          \"--translate\": `${translateValue}px`,\r\n          \"--item-scale\": itemScale,\r\n          zIndex,\r\n          opacity,\r\n          ...style,\r\n        } as React.CSSProperties\r\n      }\r\n      {...itemProps}\r\n    >\r\n      <SlotPrimitive.Slot\r\n        data-index={index}\r\n        data-position={isFront ? \"front\" : \"back\"}\r\n        data-state={getDataState(isExpanded)}\r\n      >\r\n        {children}\r\n      </SlotPrimitive.Slot>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface StackItemProps extends React.ComponentProps<\"div\"> {\r\n  asChild?: boolean;\r\n}\r\n\r\nfunction StackItem(props: StackItemProps) {\r\n  const { asChild, className, ...itemProps } = props;\r\n\r\n  const ItemPrimitive = asChild ? SlotPrimitive.Slot : \"div\";\r\n\r\n  return (\r\n    <ItemPrimitive\r\n      data-slot=\"stack-item\"\r\n      {...itemProps}\r\n      className={cn(\r\n        \"rounded-lg border bg-card p-4 shadow-sm transition-shadow duration-200 hover:shadow-md\",\r\n        className,\r\n      )}\r\n    />\r\n  );\r\n}\r\n\r\nexport {\r\n  Stack,\r\n  StackItem,\r\n  //\r\n  type StackProps,\r\n};\r\n",
      "type": "registry:ui",
      "target": ""
    }
  ],
  "type": "registry:ui"
}