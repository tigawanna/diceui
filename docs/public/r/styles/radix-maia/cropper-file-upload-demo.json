{
  "name": "cropper-file-upload-demo",
  "dependencies": [
    "@hookform/resolvers",
    "react-hook-form",
    "zod"
  ],
  "registryDependencies": [
    "cropper",
    "button",
    "dialog",
    "label",
    "slider"
  ],
  "files": [
    {
      "path": "examples/cropper-file-upload-demo.tsx",
      "content": "\"use client\";\r\n\r\nimport { CropIcon, UploadIcon, XIcon } from \"lucide-react\";\r\nimport * as React from \"react\";\r\nimport { toast } from \"sonner\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Slider } from \"@/components/ui/slider\";\r\nimport {\r\n  Cropper,\r\n  CropperArea,\r\n  type CropperAreaData,\r\n  CropperImage,\r\n  type CropperPoint,\r\n  type CropperProps,\r\n} from \"@/registry/bases/radix/ui/cropper\";\r\nimport {\r\n  FileUpload,\r\n  FileUploadDropzone,\r\n  FileUploadItem,\r\n  FileUploadItemDelete,\r\n  FileUploadItemMetadata,\r\n  FileUploadItemPreview,\r\n  FileUploadList,\r\n  FileUploadTrigger,\r\n} from \"@/registry/bases/radix/ui/file-upload\";\r\n\r\nasync function createCroppedImage(\r\n  imageSrc: string,\r\n  cropData: CropperAreaData,\r\n  fileName: string,\r\n): Promise<File> {\r\n  const image = new Image();\r\n  image.crossOrigin = \"anonymous\";\r\n\r\n  return new Promise((resolve, reject) => {\r\n    image.onload = () => {\r\n      const canvas = document.createElement(\"canvas\");\r\n      const ctx = canvas.getContext(\"2d\");\r\n\r\n      if (!ctx) {\r\n        reject(new Error(\"Could not get canvas context\"));\r\n        return;\r\n      }\r\n\r\n      canvas.width = cropData.width;\r\n      canvas.height = cropData.height;\r\n\r\n      ctx.drawImage(\r\n        image,\r\n        cropData.x,\r\n        cropData.y,\r\n        cropData.width,\r\n        cropData.height,\r\n        0,\r\n        0,\r\n        cropData.width,\r\n        cropData.height,\r\n      );\r\n\r\n      canvas.toBlob((blob) => {\r\n        if (!blob) {\r\n          reject(new Error(\"Canvas is empty\"));\r\n          return;\r\n        }\r\n\r\n        const croppedFile = new File([blob], `cropped-${fileName}`, {\r\n          type: \"image/png\",\r\n        });\r\n        resolve(croppedFile);\r\n      }, \"image/png\");\r\n    };\r\n\r\n    image.onerror = () => reject(new Error(\"Failed to load image\"));\r\n    image.src = imageSrc;\r\n  });\r\n}\r\n\r\ninterface FileWithCrop {\r\n  original: File;\r\n  cropped?: File;\r\n}\r\n\r\nexport default function CropperFileUploadDemo() {\r\n  const [files, setFiles] = React.useState<File[]>([]);\r\n  const [filesWithCrops, setFilesWithCrops] = React.useState<\r\n    Map<string, FileWithCrop>\r\n  >(new Map());\r\n  const [selectedFile, setSelectedFile] = React.useState<File | null>(null);\r\n  const [crop, setCrop] = React.useState<CropperPoint>({ x: 0, y: 0 });\r\n  const [zoom, setZoom] = React.useState(1);\r\n  const [croppedArea, setCroppedArea] = React.useState<CropperAreaData | null>(\r\n    null,\r\n  );\r\n  const [showCropDialog, setShowCropDialog] = React.useState(false);\r\n\r\n  const selectedImageUrl = React.useMemo(() => {\r\n    if (!selectedFile) return null;\r\n    return URL.createObjectURL(selectedFile);\r\n  }, [selectedFile]);\r\n\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (selectedImageUrl) {\r\n        URL.revokeObjectURL(selectedImageUrl);\r\n      }\r\n    };\r\n  }, [selectedImageUrl]);\r\n\r\n  const onFilesChange = React.useCallback((newFiles: File[]) => {\r\n    setFiles(newFiles);\r\n\r\n    setFilesWithCrops((prevFilesWithCrops) => {\r\n      const updatedFilesWithCrops = new Map(prevFilesWithCrops);\r\n\r\n      for (const file of newFiles) {\r\n        if (!updatedFilesWithCrops.has(file.name)) {\r\n          updatedFilesWithCrops.set(file.name, { original: file });\r\n        }\r\n      }\r\n\r\n      const fileNames = new Set(newFiles.map((f) => f.name));\r\n      for (const [fileName] of updatedFilesWithCrops) {\r\n        if (!fileNames.has(fileName)) {\r\n          updatedFilesWithCrops.delete(fileName);\r\n        }\r\n      }\r\n\r\n      return updatedFilesWithCrops;\r\n    });\r\n  }, []);\r\n\r\n  const onFileSelect = React.useCallback(\r\n    (file: File) => {\r\n      const fileWithCrop = filesWithCrops.get(file.name);\r\n      const originalFile = fileWithCrop?.original ?? file;\r\n\r\n      setSelectedFile(originalFile);\r\n      setCrop({ x: 0, y: 0 });\r\n      setZoom(1);\r\n      setCroppedArea(null);\r\n      setShowCropDialog(true);\r\n    },\r\n    [filesWithCrops],\r\n  );\r\n\r\n  const onCropAreaChange: NonNullable<CropperProps[\"onCropAreaChange\"]> =\r\n    React.useCallback((_, croppedAreaPixels) => {\r\n      setCroppedArea(croppedAreaPixels);\r\n    }, []);\r\n\r\n  const onCropComplete: NonNullable<CropperProps[\"onCropComplete\"]> =\r\n    React.useCallback((_, croppedAreaPixels) => {\r\n      setCroppedArea(croppedAreaPixels);\r\n    }, []);\r\n\r\n  const onCropReset = React.useCallback(() => {\r\n    setCrop({ x: 0, y: 0 });\r\n    setZoom(1);\r\n    setCroppedArea(null);\r\n  }, []);\r\n\r\n  const onCropDialogOpenChange = React.useCallback((open: boolean) => {\r\n    if (!open) {\r\n      setShowCropDialog(false);\r\n      setCrop({ x: 0, y: 0 });\r\n      setZoom(1);\r\n      setCroppedArea(null);\r\n    }\r\n  }, []);\r\n\r\n  const onCropApply = React.useCallback(async () => {\r\n    if (!selectedFile || !croppedArea || !selectedImageUrl) return;\r\n\r\n    try {\r\n      const croppedFile = await createCroppedImage(\r\n        selectedImageUrl,\r\n        croppedArea,\r\n        selectedFile.name,\r\n      );\r\n\r\n      const newFilesWithCrops = new Map(filesWithCrops);\r\n      const existing = newFilesWithCrops.get(selectedFile.name);\r\n      if (existing) {\r\n        newFilesWithCrops.set(selectedFile.name, {\r\n          ...existing,\r\n          cropped: croppedFile,\r\n        });\r\n        setFilesWithCrops(newFilesWithCrops);\r\n      }\r\n\r\n      onCropDialogOpenChange(false);\r\n    } catch (error) {\r\n      toast.error(\r\n        error instanceof Error ? error.message : \"Failed to crop image\",\r\n      );\r\n    }\r\n  }, [\r\n    selectedFile,\r\n    croppedArea,\r\n    selectedImageUrl,\r\n    filesWithCrops,\r\n    onCropDialogOpenChange,\r\n  ]);\r\n\r\n  return (\r\n    <FileUpload\r\n      value={files}\r\n      onValueChange={onFilesChange}\r\n      accept=\"image/*\"\r\n      maxFiles={2}\r\n      maxSize={10 * 1024 * 1024}\r\n      multiple\r\n      className=\"w-full max-w-lg\"\r\n    >\r\n      <FileUploadDropzone className=\"min-h-32\">\r\n        <div className=\"flex flex-col items-center gap-2 text-center\">\r\n          <UploadIcon className=\"size-8 text-muted-foreground\" />\r\n          <div>\r\n            <p className=\"font-medium text-sm\">\r\n              Drop images here or click to upload\r\n            </p>\r\n            <p className=\"text-muted-foreground text-xs\">\r\n              PNG, JPG, WebP up to 10MB\r\n            </p>\r\n          </div>\r\n          <FileUploadTrigger asChild>\r\n            <Button variant=\"outline\" size=\"sm\">\r\n              Choose Files\r\n            </Button>\r\n          </FileUploadTrigger>\r\n        </div>\r\n      </FileUploadDropzone>\r\n      <FileUploadList className=\"max-h-96 overflow-y-auto\">\r\n        {files.map((file) => {\r\n          const fileWithCrop = filesWithCrops.get(file.name);\r\n\r\n          return (\r\n            <FileUploadItem key={file.name} value={file}>\r\n              <FileUploadItemPreview\r\n                render={(originalFile, fallback) => {\r\n                  if (\r\n                    fileWithCrop?.cropped &&\r\n                    originalFile.type.startsWith(\"image/\")\r\n                  ) {\r\n                    const url = URL.createObjectURL(fileWithCrop.cropped);\r\n                    return (\r\n                      // biome-ignore lint/performance/noImgElement: dynamic cropped file URLs from user uploads don't work well with Next.js Image optimization\r\n                      <img\r\n                        src={url}\r\n                        alt={originalFile.name}\r\n                        className=\"size-full object-cover\"\r\n                      />\r\n                    );\r\n                  }\r\n\r\n                  return fallback();\r\n                }}\r\n              />\r\n              <FileUploadItemMetadata />\r\n              <div className=\"flex gap-1\">\r\n                <Dialog\r\n                  open={showCropDialog}\r\n                  onOpenChange={onCropDialogOpenChange}\r\n                >\r\n                  <DialogTrigger asChild>\r\n                    <Button\r\n                      variant=\"ghost\"\r\n                      size=\"icon\"\r\n                      className=\"size-8\"\r\n                      onClick={() => onFileSelect(file)}\r\n                    >\r\n                      <CropIcon />\r\n                    </Button>\r\n                  </DialogTrigger>\r\n                  <DialogContent className=\"max-w-4xl\">\r\n                    <DialogHeader>\r\n                      <DialogTitle>Crop Image</DialogTitle>\r\n                      <DialogDescription>\r\n                        Adjust the crop area and zoom level for{\" \"}\r\n                        {selectedFile?.name}\r\n                      </DialogDescription>\r\n                    </DialogHeader>\r\n                    {selectedFile && selectedImageUrl && (\r\n                      <div className=\"flex flex-col gap-4\">\r\n                        <Cropper\r\n                          aspectRatio={1}\r\n                          shape=\"circle\"\r\n                          crop={crop}\r\n                          onCropChange={setCrop}\r\n                          zoom={zoom}\r\n                          onZoomChange={setZoom}\r\n                          onCropAreaChange={onCropAreaChange}\r\n                          onCropComplete={onCropComplete}\r\n                          className=\"h-96\"\r\n                        >\r\n                          <CropperImage\r\n                            src={selectedImageUrl}\r\n                            alt={selectedFile.name}\r\n                            crossOrigin=\"anonymous\"\r\n                          />\r\n                          <CropperArea />\r\n                        </Cropper>\r\n                        <div className=\"flex flex-col gap-2\">\r\n                          <Label className=\"text-sm\">\r\n                            Zoom: {zoom.toFixed(2)}\r\n                          </Label>\r\n                          <Slider\r\n                            value={[zoom]}\r\n                            onValueChange={(value) => setZoom(value[0] ?? 1)}\r\n                            min={1}\r\n                            max={3}\r\n                            step={0.1}\r\n                            className=\"w-full\"\r\n                          />\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                    <DialogFooter>\r\n                      <Button onClick={onCropReset} variant=\"outline\">\r\n                        Reset\r\n                      </Button>\r\n                      <Button onClick={onCropApply} disabled={!croppedArea}>\r\n                        Crop\r\n                      </Button>\r\n                    </DialogFooter>\r\n                  </DialogContent>\r\n                </Dialog>\r\n                <FileUploadItemDelete asChild>\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"icon\"\r\n                    className=\"size-8 hover:bg-destructive/30 hover:text-destructive-foreground dark:hover:bg-destructive dark:hover:text-destructive-foreground\"\r\n                  >\r\n                    <XIcon />\r\n                  </Button>\r\n                </FileUploadItemDelete>\r\n              </div>\r\n            </FileUploadItem>\r\n          );\r\n        })}\r\n      </FileUploadList>\r\n    </FileUpload>\r\n  );\r\n}\r\n",
      "type": "registry:example",
      "target": ""
    }
  ],
  "type": "registry:example"
}