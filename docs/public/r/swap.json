{
  "name": "swap",
  "dependencies": [
    "@radix-ui/react-slot"
  ],
  "registryDependencies": [
    "@diceui/use-as-ref",
    "@diceui/use-isomorphic-layout-effect",
    "@diceui/use-lazy-ref"
  ],
  "files": [
    {
      "path": "ui/swap.tsx",
      "content": "\"use client\";\r\n\r\nimport { Slot } from \"@radix-ui/react-slot\";\r\nimport * as React from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { useAsRef } from \"@/registry/default/hooks/use-as-ref\";\r\nimport { useIsomorphicLayoutEffect } from \"@/registry/default/hooks/use-isomorphic-layout-effect\";\r\nimport { useLazyRef } from \"@/registry/default/hooks/use-lazy-ref\";\r\n\r\ninterface DivProps extends React.ComponentProps<\"div\"> {\r\n  asChild?: boolean;\r\n}\r\n\r\nfunction getDataState(swapped: boolean) {\r\n  return swapped ? \"on\" : \"off\";\r\n}\r\n\r\ninterface StoreState {\r\n  swapped: boolean;\r\n}\r\n\r\ninterface Store {\r\n  subscribe: (callback: () => void) => () => void;\r\n  getState: () => StoreState;\r\n  setState: <K extends keyof StoreState>(key: K, value: StoreState[K]) => void;\r\n  notify: () => void;\r\n}\r\n\r\nconst StoreContext = React.createContext<Store | null>(null);\r\n\r\nfunction useStore<T>(\r\n  selector: (state: StoreState) => T,\r\n  ogStore?: Store | null,\r\n): T {\r\n  const contextStore = React.useContext(StoreContext);\r\n\r\n  const store = ogStore ?? contextStore;\r\n\r\n  if (!store) {\r\n    throw new Error(`\\`useStore\\` must be used within \\`Swap\\``);\r\n  }\r\n\r\n  const getSnapshot = React.useCallback(\r\n    () => selector(store.getState()),\r\n    [store, selector],\r\n  );\r\n\r\n  return React.useSyncExternalStore(store.subscribe, getSnapshot, getSnapshot);\r\n}\r\n\r\ninterface SwapProps extends DivProps {\r\n  swapped?: boolean;\r\n  defaultSwapped?: boolean;\r\n  onSwappedChange?: (swapped: boolean) => void;\r\n  activationMode?: \"click\" | \"hover\";\r\n  animation?: \"fade\" | \"rotate\" | \"flip\" | \"scale\";\r\n  disabled?: boolean;\r\n}\r\n\r\nfunction Swap(props: SwapProps) {\r\n  const {\r\n    swapped: swappedProp,\r\n    defaultSwapped,\r\n    onSwappedChange,\r\n    activationMode = \"click\",\r\n    animation = \"fade\",\r\n    disabled,\r\n    asChild,\r\n    className,\r\n    onClick: onClickProp,\r\n    onMouseEnter: onMouseEnterProp,\r\n    onMouseLeave: onMouseLeaveProp,\r\n    onKeyDown: onKeyDownProp,\r\n    ...rootProps\r\n  } = props;\r\n\r\n  const listenersRef = useLazyRef(() => new Set<() => void>());\r\n  const stateRef = useLazyRef<StoreState>(() => ({\r\n    swapped: swappedProp ?? defaultSwapped ?? false,\r\n  }));\r\n\r\n  const propsRef = useAsRef({\r\n    activationMode,\r\n    animation,\r\n    disabled,\r\n    onSwappedChange,\r\n    onClick: onClickProp,\r\n    onMouseEnter: onMouseEnterProp,\r\n    onMouseLeave: onMouseLeaveProp,\r\n    onKeyDown: onKeyDownProp,\r\n  });\r\n\r\n  const isClickMode = activationMode === \"click\";\r\n\r\n  const store = React.useMemo<Store>(() => {\r\n    return {\r\n      subscribe: (cb) => {\r\n        listenersRef.current.add(cb);\r\n        return () => listenersRef.current.delete(cb);\r\n      },\r\n      getState: () => stateRef.current,\r\n      setState: (key, value) => {\r\n        if (Object.is(stateRef.current[key], value)) return;\r\n\r\n        if (key === \"swapped\" && typeof value === \"boolean\") {\r\n          stateRef.current.swapped = value;\r\n          propsRef.current.onSwappedChange?.(value);\r\n        } else {\r\n          stateRef.current[key] = value;\r\n        }\r\n\r\n        store.notify();\r\n      },\r\n      notify: () => {\r\n        for (const cb of listenersRef.current) {\r\n          cb();\r\n        }\r\n      },\r\n    };\r\n  }, [listenersRef, stateRef, propsRef]);\r\n\r\n  const swapped = useStore((state) => state.swapped, store);\r\n\r\n  useIsomorphicLayoutEffect(() => {\r\n    if (swappedProp !== undefined) {\r\n      store.setState(\"swapped\", swappedProp);\r\n    }\r\n  }, [swappedProp]);\r\n\r\n  const onToggle = React.useCallback(() => {\r\n    if (propsRef.current.disabled) return;\r\n\r\n    store.setState(\"swapped\", !store.getState().swapped);\r\n  }, [store, propsRef]);\r\n\r\n  const onClick = React.useCallback(\r\n    (event: React.MouseEvent<HTMLDivElement>) => {\r\n      propsRef.current.onClick?.(event);\r\n      if (event.defaultPrevented || propsRef.current.activationMode !== \"click\")\r\n        return;\r\n\r\n      onToggle();\r\n    },\r\n    [propsRef, onToggle],\r\n  );\r\n\r\n  const onMouseEnter = React.useCallback(\r\n    (event: React.MouseEvent<HTMLDivElement>) => {\r\n      propsRef.current.onMouseEnter?.(event);\r\n      if (\r\n        event.defaultPrevented ||\r\n        activationMode !== \"hover\" ||\r\n        propsRef.current.disabled\r\n      )\r\n        return;\r\n\r\n      store.setState(\"swapped\", true);\r\n    },\r\n    [propsRef, activationMode, store],\r\n  );\r\n\r\n  const onMouseLeave = React.useCallback(\r\n    (event: React.MouseEvent<HTMLDivElement>) => {\r\n      propsRef.current.onMouseLeave?.(event);\r\n      if (\r\n        event.defaultPrevented ||\r\n        activationMode !== \"hover\" ||\r\n        propsRef.current.disabled\r\n      )\r\n        return;\r\n\r\n      store.setState(\"swapped\", false);\r\n    },\r\n    [propsRef, activationMode, store],\r\n  );\r\n\r\n  const onKeyDown = React.useCallback(\r\n    (event: React.KeyboardEvent<HTMLDivElement>) => {\r\n      propsRef.current.onKeyDown?.(event);\r\n      if (\r\n        event.defaultPrevented ||\r\n        propsRef.current.activationMode !== \"click\" ||\r\n        propsRef.current.disabled\r\n      )\r\n        return;\r\n\r\n      if (event.key === \"Enter\" || event.key === \" \") {\r\n        event.preventDefault();\r\n        onToggle();\r\n      }\r\n    },\r\n    [propsRef, onToggle],\r\n  );\r\n\r\n  const RootPrimitive = asChild ? Slot : \"div\";\r\n\r\n  return (\r\n    <StoreContext.Provider value={store}>\r\n      <RootPrimitive\r\n        role={isClickMode ? \"button\" : undefined}\r\n        aria-pressed={isClickMode ? swapped : undefined}\r\n        aria-disabled={disabled}\r\n        data-slot=\"swap\"\r\n        data-animation={animation}\r\n        data-state={getDataState(swapped)}\r\n        data-disabled={disabled ? \"\" : undefined}\r\n        tabIndex={isClickMode && !disabled ? 0 : undefined}\r\n        {...rootProps}\r\n        className={cn(\r\n          \"relative inline-flex cursor-pointer select-none items-center justify-center data-disabled:cursor-not-allowed data-disabled:opacity-50\",\r\n          className,\r\n        )}\r\n        onClick={onClick}\r\n        onMouseEnter={onMouseEnter}\r\n        onMouseLeave={onMouseLeave}\r\n        onKeyDown={onKeyDown}\r\n      />\r\n    </StoreContext.Provider>\r\n  );\r\n}\r\n\r\nfunction SwapOn(props: DivProps) {\r\n  const { asChild, className, ...onProps } = props;\r\n\r\n  const swapped = useStore((state) => state.swapped);\r\n\r\n  const OnPrimitive = asChild ? Slot : \"div\";\r\n\r\n  return (\r\n    <OnPrimitive\r\n      data-slot=\"swap-on\"\r\n      data-state={getDataState(swapped)}\r\n      {...onProps}\r\n      className={cn(\r\n        \"transition-all duration-300 data-[state=off]:absolute data-[state=off]:opacity-0 data-[state=on]:opacity-100 motion-reduce:transition-none\",\r\n        \"[*[data-animation=rotate]_&]:data-[state=off]:rotate-180 [*[data-animation=rotate]_&]:data-[state=on]:rotate-0 motion-reduce:[*[data-animation=rotate]_&]:data-[state=off]:rotate-0\",\r\n        \"[*[data-animation=flip]_&]:data-[state=off]:transform-[rotateY(180deg)] [*[data-animation=flip]_&]:data-[state=on]:transform-[rotateY(0deg)] motion-reduce:[*[data-animation=flip]_&]:data-[state=off]:transform-[rotateY(0deg)]\",\r\n        \"[*[data-animation=scale]_&]:data-[state=off]:scale-0 [*[data-animation=scale]_&]:data-[state=on]:scale-100 motion-reduce:[*[data-animation=scale]_&]:data-[state=off]:scale-100\",\r\n        className,\r\n      )}\r\n    />\r\n  );\r\n}\r\n\r\nfunction SwapOff(props: DivProps) {\r\n  const { asChild, className, ...offProps } = props;\r\n\r\n  const swapped = useStore((state) => state.swapped);\r\n\r\n  const OffPrimitive = asChild ? Slot : \"div\";\r\n\r\n  return (\r\n    <OffPrimitive\r\n      data-slot=\"swap-off\"\r\n      data-state={getDataState(swapped)}\r\n      {...offProps}\r\n      className={cn(\r\n        \"transition-all duration-300 data-[state=on]:absolute data-[state=off]:opacity-100 data-[state=on]:opacity-0 motion-reduce:transition-none\",\r\n        \"[*[data-animation=rotate]_&]:data-[state=off]:rotate-0 [*[data-animation=rotate]_&]:data-[state=on]:rotate-180 motion-reduce:[*[data-animation=rotate]_&]:data-[state=on]:rotate-0\",\r\n        \"[*[data-animation=flip]_&]:data-[state=off]:transform-[rotateY(0deg)] [*[data-animation=flip]_&]:data-[state=on]:transform-[rotateY(180deg)] motion-reduce:[*[data-animation=flip]_&]:data-[state=on]:transform-[rotateY(0deg)]\",\r\n        \"[*[data-animation=scale]_&]:data-[state=off]:scale-100 [*[data-animation=scale]_&]:data-[state=on]:scale-0 motion-reduce:[*[data-animation=scale]_&]:data-[state=on]:scale-100\",\r\n        className,\r\n      )}\r\n    />\r\n  );\r\n}\r\n\r\nexport {\r\n  Swap,\r\n  SwapOn,\r\n  SwapOff,\r\n  //\r\n  useStore as useSwap,\r\n  //\r\n  type SwapProps,\r\n};\r\n",
      "type": "registry:ui",
      "target": ""
    }
  ],
  "type": "registry:ui"
}